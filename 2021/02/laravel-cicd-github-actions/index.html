<!DOCTYPE html>
<html lang="zh-TW">
<head>

  <meta charset="utf-8" />

  
  <title>Laravel CICD with Github Actions</title>

  
  
  <link href="//cdn.jsdelivr.net" rel="dns-prefetch">
  <link href="//cdnjs.cloudflare.com" rel="dns-prefetch">
  
  <link href="//at.alicdn.com" rel="dns-prefetch">
  
  <link href="//fonts.googleapis.com" rel="dns-prefetch">
  <link href="//fonts.gstatic.com" rel="dns-prefetch">
  <link href="///disqus.com" rel="dns-prefetch">
  <link href="//c.disquscdn.com" rel="dns-prefetch">
  
  
  

  

  
  <meta name="author" content="Tuvix Shih">
  <meta name="description" content="GitHub Actions ç‚º 2019 å¹´ 11 æœˆ GitHub æ¨å‡ºçš„æœå‹™ï¼Œå¯ä»¥ç”¨ä¾†æ¸¬è©¦ã€å°è£ã€ç™¼ä½ˆæˆ–æ˜¯éƒ¨ç½²ç¨‹å¼ç¢¼ï¼Œä¸€é€£ä¸²çš„å‹•ä½œå»ºç«‹è‡ªå‹•åŒ–çš„æµç¨‹ï¼Œé”åˆ°æŒçºŒæ•´åˆ/æŒçºŒéƒ¨ç½²ï¼ˆCI/CDï¼‰çš„ç›®çš„ã€‚
Github è®“é–‹ç™¼è€…èƒ½å°‡ä¸€äº›é‡è¤‡çš„å‹•ä½œå¯«æˆè…³æœ¬ï¼Œä½¿å…¶ä»–é–‹ç™¼è€…ä¹Ÿå¯ä»¥å¼•ç”¨é€™äº› Actionï¼ŒæŠŠé€™äº› Action çµ„åˆèµ·ä¾†åŸ·è¡Œï¼Œå°±èƒ½å¤ å®Œæˆå‰è¿° CI/CD çš„éç¨‹ã€‚GitHub ç‚ºæ­¤æˆç«‹äº†ä¸€å€‹ Action çš„ Marketplaceï¼Œå¯ä»¥æœå°‹åˆ°å…¶ä»–äººä¸Šå‚³çš„ Actionã€‚
é€™ç¯‡æ–‡ç« ä¸­ï¼Œå°‡ä½¿ç”¨ GitHub Actions å°‡ Laravel å°ˆæ¡ˆæ¸¬è©¦åŠéƒ¨ç½²è‡³è‡ªå·±çš„ Linux ä¼ºæœå™¨ä¸Šã€‚
1. GitHub Actions åè©  Workflowï¼ˆå·¥ä½œæµç¨‹ï¼‰ï¼šå¯è¨­å®šç‚ºä¸€å€‹è‡ªå‹•åŒ–æµç¨‹çš„ç¨‹åºï¼ŒWorkflow ç”±ä¸€å€‹æˆ–å¤šå€‹ Job çµ„æˆï¼Œå¯ç¶“ç”±äº‹ä»¶è§¸ç™¼åŸ·è¡Œï¼Œæ˜¯ YAML æ ¼å¼æª”æ¡ˆæ”¾åœ¨ .github/workflows è³‡æ–™å¤¾ä¸­ã€‚ Jobï¼ˆä»»å‹™ï¼‰ï¼šæ¯å€‹ Job ç”±å¤šå€‹ Step çµ„æˆï¼Œä¸€å€‹ Job æœƒåœ¨ä¸€å€‹æ–°çš„åŸ·è¡Œå¯¦ä¾‹ä¸­ï¼ˆinstanceï¼‰åŸ·è¡Œã€‚ä¸åŒçš„ Job å¯ä»¥åŒæ™‚åŸ·è¡Œï¼Œä¹Ÿå¯ä»¥ä¾ç…§å‰é¢çš„ Job ç‹€æ…‹ä¾é †åºåŸ·è¡Œã€‚ Stepï¼ˆæ­¥é©Ÿï¼‰ï¼šæ¯å€‹ Step éƒ½æ˜¯åœ¨ç›¸åŒçš„åŸ·è¡Œå¯¦ä¾‹ä¸­åŸ·è¡Œï¼ŒStep å¯ä»¥æ˜¯åŸ·è¡ŒæŒ‡ä»¤æˆ–æ˜¯ Actionã€‚æ¯å€‹ Step å¯ä»¥åŸ·è¡Œä¸€å€‹æˆ–å¤šå€‹ Actionã€‚ Actionï¼ˆå‹•ä½œï¼‰ï¼šWorkflow æœ€å°å–®ä½ã€‚  2. Workflow æ–‡ä»¶ GitHub Actions çš„ workflow æ–‡ä»¶ç‚º YAML æ ¼å¼ï¼Œæ–‡ä»¶åç¨±å¯ä»¥è‡ªå®šä½†å‰¯æª”åç‚º .">

  
  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@jeffyshih">
    <meta name="twitter:title" content="Laravel CICD with Github Actions">
    <meta name="twitter:description" content="GitHub Actions ç‚º 2019 å¹´ 11 æœˆ GitHub æ¨å‡ºçš„æœå‹™ï¼Œå¯ä»¥ç”¨ä¾†æ¸¬è©¦ã€å°è£ã€ç™¼ä½ˆæˆ–æ˜¯éƒ¨ç½²ç¨‹å¼ç¢¼ï¼Œä¸€é€£ä¸²çš„å‹•ä½œå»ºç«‹è‡ªå‹•åŒ–çš„æµç¨‹ï¼Œé”åˆ°æŒçºŒæ•´åˆ/æŒçºŒéƒ¨ç½²ï¼ˆCI/CDï¼‰çš„ç›®çš„ã€‚
Github è®“é–‹ç™¼è€…èƒ½å°‡ä¸€äº›é‡è¤‡çš„å‹•ä½œå¯«æˆè…³æœ¬ï¼Œä½¿å…¶ä»–é–‹ç™¼è€…ä¹Ÿå¯ä»¥å¼•ç”¨é€™äº› Actionï¼ŒæŠŠé€™äº› Action çµ„åˆèµ·ä¾†åŸ·è¡Œï¼Œå°±èƒ½å¤ å®Œæˆå‰è¿° CI/CD çš„éç¨‹ã€‚GitHub ç‚ºæ­¤æˆç«‹äº†ä¸€å€‹ Action çš„ Marketplaceï¼Œå¯ä»¥æœå°‹åˆ°å…¶ä»–äººä¸Šå‚³çš„ Actionã€‚
é€™ç¯‡æ–‡ç« ä¸­ï¼Œå°‡ä½¿ç”¨ GitHub Actions å°‡ Laravel å°ˆæ¡ˆæ¸¬è©¦åŠéƒ¨ç½²è‡³è‡ªå·±çš„ Linux ä¼ºæœå™¨ä¸Šã€‚
1. GitHub Actions åè©  Workflowï¼ˆå·¥ä½œæµç¨‹ï¼‰ï¼šå¯è¨­å®šç‚ºä¸€å€‹è‡ªå‹•åŒ–æµç¨‹çš„ç¨‹åºï¼ŒWorkflow ç”±ä¸€å€‹æˆ–å¤šå€‹ Job çµ„æˆï¼Œå¯ç¶“ç”±äº‹ä»¶è§¸ç™¼åŸ·è¡Œï¼Œæ˜¯ YAML æ ¼å¼æª”æ¡ˆæ”¾åœ¨ .github/workflows è³‡æ–™å¤¾ä¸­ã€‚ Jobï¼ˆä»»å‹™ï¼‰ï¼šæ¯å€‹ Job ç”±å¤šå€‹ Step çµ„æˆï¼Œä¸€å€‹ Job æœƒåœ¨ä¸€å€‹æ–°çš„åŸ·è¡Œå¯¦ä¾‹ä¸­ï¼ˆinstanceï¼‰åŸ·è¡Œã€‚ä¸åŒçš„ Job å¯ä»¥åŒæ™‚åŸ·è¡Œï¼Œä¹Ÿå¯ä»¥ä¾ç…§å‰é¢çš„ Job ç‹€æ…‹ä¾é †åºåŸ·è¡Œã€‚ Stepï¼ˆæ­¥é©Ÿï¼‰ï¼šæ¯å€‹ Step éƒ½æ˜¯åœ¨ç›¸åŒçš„åŸ·è¡Œå¯¦ä¾‹ä¸­åŸ·è¡Œï¼ŒStep å¯ä»¥æ˜¯åŸ·è¡ŒæŒ‡ä»¤æˆ–æ˜¯ Actionã€‚æ¯å€‹ Step å¯ä»¥åŸ·è¡Œä¸€å€‹æˆ–å¤šå€‹ Actionã€‚ Actionï¼ˆå‹•ä½œï¼‰ï¼šWorkflow æœ€å°å–®ä½ã€‚  2. Workflow æ–‡ä»¶ GitHub Actions çš„ workflow æ–‡ä»¶ç‚º YAML æ ¼å¼ï¼Œæ–‡ä»¶åç¨±å¯ä»¥è‡ªå®šä½†å‰¯æª”åç‚º .">
    <meta name="twitter:image" content="https://ninthday.github.io/images/github.png">
  

  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Laravel CICD with Github Actions">
  <meta property="og:description" content="GitHub Actions ç‚º 2019 å¹´ 11 æœˆ GitHub æ¨å‡ºçš„æœå‹™ï¼Œå¯ä»¥ç”¨ä¾†æ¸¬è©¦ã€å°è£ã€ç™¼ä½ˆæˆ–æ˜¯éƒ¨ç½²ç¨‹å¼ç¢¼ï¼Œä¸€é€£ä¸²çš„å‹•ä½œå»ºç«‹è‡ªå‹•åŒ–çš„æµç¨‹ï¼Œé”åˆ°æŒçºŒæ•´åˆ/æŒçºŒéƒ¨ç½²ï¼ˆCI/CDï¼‰çš„ç›®çš„ã€‚
Github è®“é–‹ç™¼è€…èƒ½å°‡ä¸€äº›é‡è¤‡çš„å‹•ä½œå¯«æˆè…³æœ¬ï¼Œä½¿å…¶ä»–é–‹ç™¼è€…ä¹Ÿå¯ä»¥å¼•ç”¨é€™äº› Actionï¼ŒæŠŠé€™äº› Action çµ„åˆèµ·ä¾†åŸ·è¡Œï¼Œå°±èƒ½å¤ å®Œæˆå‰è¿° CI/CD çš„éç¨‹ã€‚GitHub ç‚ºæ­¤æˆç«‹äº†ä¸€å€‹ Action çš„ Marketplaceï¼Œå¯ä»¥æœå°‹åˆ°å…¶ä»–äººä¸Šå‚³çš„ Actionã€‚
é€™ç¯‡æ–‡ç« ä¸­ï¼Œå°‡ä½¿ç”¨ GitHub Actions å°‡ Laravel å°ˆæ¡ˆæ¸¬è©¦åŠéƒ¨ç½²è‡³è‡ªå·±çš„ Linux ä¼ºæœå™¨ä¸Šã€‚
1. GitHub Actions åè©  Workflowï¼ˆå·¥ä½œæµç¨‹ï¼‰ï¼šå¯è¨­å®šç‚ºä¸€å€‹è‡ªå‹•åŒ–æµç¨‹çš„ç¨‹åºï¼ŒWorkflow ç”±ä¸€å€‹æˆ–å¤šå€‹ Job çµ„æˆï¼Œå¯ç¶“ç”±äº‹ä»¶è§¸ç™¼åŸ·è¡Œï¼Œæ˜¯ YAML æ ¼å¼æª”æ¡ˆæ”¾åœ¨ .github/workflows è³‡æ–™å¤¾ä¸­ã€‚ Jobï¼ˆä»»å‹™ï¼‰ï¼šæ¯å€‹ Job ç”±å¤šå€‹ Step çµ„æˆï¼Œä¸€å€‹ Job æœƒåœ¨ä¸€å€‹æ–°çš„åŸ·è¡Œå¯¦ä¾‹ä¸­ï¼ˆinstanceï¼‰åŸ·è¡Œã€‚ä¸åŒçš„ Job å¯ä»¥åŒæ™‚åŸ·è¡Œï¼Œä¹Ÿå¯ä»¥ä¾ç…§å‰é¢çš„ Job ç‹€æ…‹ä¾é †åºåŸ·è¡Œã€‚ Stepï¼ˆæ­¥é©Ÿï¼‰ï¼šæ¯å€‹ Step éƒ½æ˜¯åœ¨ç›¸åŒçš„åŸ·è¡Œå¯¦ä¾‹ä¸­åŸ·è¡Œï¼ŒStep å¯ä»¥æ˜¯åŸ·è¡ŒæŒ‡ä»¤æˆ–æ˜¯ Actionã€‚æ¯å€‹ Step å¯ä»¥åŸ·è¡Œä¸€å€‹æˆ–å¤šå€‹ Actionã€‚ Actionï¼ˆå‹•ä½œï¼‰ï¼šWorkflow æœ€å°å–®ä½ã€‚  2. Workflow æ–‡ä»¶ GitHub Actions çš„ workflow æ–‡ä»¶ç‚º YAML æ ¼å¼ï¼Œæ–‡ä»¶åç¨±å¯ä»¥è‡ªå®šä½†å‰¯æª”åç‚º .">
  <meta property="og:url" content="https://ninthday.github.io/2021/02/laravel-cicd-github-actions/">
  <meta property="og:image" content="https://ninthday.github.io/images/github.png">




<meta name="generator" content="Hugo 0.80.0">


<link rel="canonical" href="https://ninthday.github.io/2021/02/laravel-cicd-github-actions/">

<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="format-detection" content="telephone=no,email=no,adress=no">
<meta http-equiv="Cache-Control" content="no-transform">


<meta name="robots" content="index,follow">
<meta name="referrer" content="origin-when-cross-origin">







<meta name="theme-color" content="#02b875">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="have a NINTHDAY">
<meta name="msapplication-tooltip" content="have a NINTHDAY">
<meta name='msapplication-navbutton-color' content="#02b875">
<meta name="msapplication-TileColor" content="#02b875">
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<link rel="icon" href="https://ninthday.github.io/bee.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://ninthday.github.io/icons/icon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ninthday.github.io/icons/icon-32x32.png">
<link rel="icon" sizes="192x192" href="https://ninthday.github.io/icons/icon-192x192.png">
<link rel="apple-touch-icon" href="https://ninthday.github.io/icons/icon-152x152.png">
<link rel="manifest" href="https://ninthday.github.io/manifest.json">


<link rel="preload" href="https://ninthday.github.io/styles/main-rendered.min.css" as="style">


<link rel="preload" href="https://fonts.googleapis.com/css?family=Gochi+Hand" as="style">
<link rel="preload" href="https://ninthday.github.io/images/avatar.png" as="image">
<link rel="preload" href="https://ninthday.github.io/images/manycats.jpg" as="image">


<style>
  body {
    background: rgb(244, 243, 241) url('/images/manycats.jpg') repeat fixed;
  }
</style>
<link rel="stylesheet" href="https://ninthday.github.io/styles/main-rendered.min.css">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gochi+Hand">



<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.2/dist/medium-zoom.min.js"></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video-js.min.css">



  
  
<!--[if lte IE 8]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-ie8@1.1.2/dist/videojs-ie8.min.js"></script>
<![endif]-->

<!--[if lte IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20180112/classList.min.js"></script>
<![endif]-->


</head>
  <body>
    <div class="suspension">
      <a role="button" aria-label="Go to top" title="Go to top" class="to-top is-hide"><span class="icon icon-up" aria-hidden="true"></span></a>
      
        
	<a role="button" aria-label="Go to comments" title="Go to comments" class="to-comment" href="#disqus_thread"><span class="icon icon-comment" aria-hidden="true"></span></a>
        
      
    </div>
    
    
  <header class="site-header">
  <a href="https://ninthday.github.io"><img class="avatar" src="https://ninthday.github.io/images/avatar.png" alt="Avatar"></a>
  
  <h2 class="title"><a href="https://ninthday.github.io">have a NINTHDAY</a></h2>
  
  <p class="subtitle">~ Live Long and Prosper ğŸ–– ~</p>
  <button class="menu-toggle" type="button" aria-label="Main Menu" aria-expanded="false" tab-index="0">
    <span class="icon icon-menu" aria-hidden="true"></span>
  </button>

  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
          
          
           is-active">
          <a href="https://ninthday.github.io/post">Home</a>
        </li>
      
        <li class="menu-item
          
          
          ">
          <a href="https://github.com/ninthday">Works</a>
        </li>
      
        <li class="menu-item
          
          
          ">
          <a href="https://ninthday.github.io/tags">Tags</a>
        </li>
      
        <li class="menu-item
          
          
          ">
          <a href="https://ninthday.github.io/about/">About</a>
        </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list"><li class="social-item">
          <a href="mailto:tuvix@ninthday.me" title="Email" aria-label="Email">
            <span class="icon icon-email" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//github.com/ninthday" rel="me" title="GitHub" aria-label="GitHub">
	    <span class="icon icon-github" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//twitter.com/jeffyshih" rel="me" title="Twitter" aria-label="Twitter">
            <span class="icon icon-twitter" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//www.linkedin.com/in/shiuh-feng-shih" rel="me" title="LinkedIn" aria-label="LinkedIn">
            <span class="icon icon-linkedin" aria-hidden="true"></span>
          </a>
        </li></ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Laravel CICD with Github Actions</h1>
      <p class="post-meta">@Tuvix Shih Â· Feb 28, 2021 Â· 5 min read</p>
    </header>
    <article class="post-content"><p>GitHub Actions ç‚º 2019 å¹´ 11 æœˆ GitHub æ¨å‡ºçš„æœå‹™ï¼Œå¯ä»¥ç”¨ä¾†æ¸¬è©¦ã€å°è£ã€ç™¼ä½ˆæˆ–æ˜¯éƒ¨ç½²ç¨‹å¼ç¢¼ï¼Œä¸€é€£ä¸²çš„å‹•ä½œå»ºç«‹è‡ªå‹•åŒ–çš„æµç¨‹ï¼Œé”åˆ°æŒçºŒæ•´åˆ/æŒçºŒéƒ¨ç½²ï¼ˆCI/CDï¼‰çš„ç›®çš„ã€‚</p>
<p>Github è®“é–‹ç™¼è€…èƒ½å°‡ä¸€äº›é‡è¤‡çš„å‹•ä½œå¯«æˆè…³æœ¬ï¼Œä½¿å…¶ä»–é–‹ç™¼è€…ä¹Ÿå¯ä»¥å¼•ç”¨é€™äº› Actionï¼ŒæŠŠé€™äº› Action çµ„åˆèµ·ä¾†åŸ·è¡Œï¼Œå°±èƒ½å¤ å®Œæˆå‰è¿° CI/CD çš„éç¨‹ã€‚GitHub ç‚ºæ­¤æˆç«‹äº†ä¸€å€‹ Action çš„ <a href="https://github.com/marketplace?type=actions">Marketplace</a>ï¼Œå¯ä»¥æœå°‹åˆ°å…¶ä»–äººä¸Šå‚³çš„ Actionã€‚</p>
<p>é€™ç¯‡æ–‡ç« ä¸­ï¼Œå°‡ä½¿ç”¨ GitHub Actions å°‡ Laravel å°ˆæ¡ˆæ¸¬è©¦åŠéƒ¨ç½²è‡³è‡ªå·±çš„ Linux ä¼ºæœå™¨ä¸Šã€‚</p>
<h2 id="1-github-actions-åè©">1. GitHub Actions åè©</h2>
<ul>
<li>Workflowï¼ˆå·¥ä½œæµç¨‹ï¼‰ï¼šå¯è¨­å®šç‚ºä¸€å€‹è‡ªå‹•åŒ–æµç¨‹çš„ç¨‹åºï¼ŒWorkflow ç”±ä¸€å€‹æˆ–å¤šå€‹ Job çµ„æˆï¼Œå¯ç¶“ç”±äº‹ä»¶è§¸ç™¼åŸ·è¡Œï¼Œæ˜¯ YAML æ ¼å¼æª”æ¡ˆæ”¾åœ¨ <code>.github/workflows</code> è³‡æ–™å¤¾ä¸­ã€‚</li>
<li>Jobï¼ˆä»»å‹™ï¼‰ï¼šæ¯å€‹ Job ç”±å¤šå€‹ Step çµ„æˆï¼Œä¸€å€‹ Job æœƒåœ¨ä¸€å€‹æ–°çš„åŸ·è¡Œå¯¦ä¾‹ä¸­ï¼ˆinstanceï¼‰åŸ·è¡Œã€‚ä¸åŒçš„ Job å¯ä»¥åŒæ™‚åŸ·è¡Œï¼Œä¹Ÿå¯ä»¥ä¾ç…§å‰é¢çš„ Job ç‹€æ…‹ä¾é †åºåŸ·è¡Œã€‚</li>
<li>Stepï¼ˆæ­¥é©Ÿï¼‰ï¼šæ¯å€‹ Step éƒ½æ˜¯åœ¨ç›¸åŒçš„åŸ·è¡Œå¯¦ä¾‹ä¸­åŸ·è¡Œï¼ŒStep å¯ä»¥æ˜¯åŸ·è¡ŒæŒ‡ä»¤æˆ–æ˜¯ Actionã€‚æ¯å€‹ Step å¯ä»¥åŸ·è¡Œä¸€å€‹æˆ–å¤šå€‹ Actionã€‚</li>
<li>Actionï¼ˆå‹•ä½œï¼‰ï¼šWorkflow æœ€å°å–®ä½ã€‚</li>
</ul>
<h2 id="2-workflow-æ–‡ä»¶">2. Workflow æ–‡ä»¶</h2>
<p>GitHub Actions çš„ workflow æ–‡ä»¶ç‚º YAML æ ¼å¼ï¼Œæ–‡ä»¶åç¨±å¯ä»¥è‡ªå®šä½†å‰¯æª”åç‚º <code>.yml</code>ã€‚GitHub åªè¦åœ¨ <code>.github/workflows</code> è³‡æ–™å¤¾ä¸­ç™¼ç¾æœ‰ <code>.yml</code> æ–‡ä»¶å°±æœƒè‡ªå‹•åŸ·è¡Œã€‚</p>
<p>é€™å€‹ YAML æ–‡ä»¶çš„èªæ³•åˆ†ç‚ºå¹¾å€‹éƒ¨åˆ†</p>
<ul>
<li><strong>name</strong>: workflow åç¨±</li>
<li><strong>on</strong>
æŒ‡å®šè§¸ç™¼ workflow çš„æ¢ä»¶ï¼ˆäº‹ä»¶ï¼‰</li>
<li><strong>jobs</strong>
workflow YAML æ–‡ä»¶çš„ä¸»è¦éƒ¨åˆ†ï¼Œ<code>jobs</code> ä¸­åŒ…å«ä¸€æˆ–å¤šå€‹ <code>job</code>ï¼Œåˆ—å‡ºæ¯ä¸€å€‹ <code>job_id</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>needs</code> é—œéµå­—æŒ‡å®šå’Œå…¶ä»– <code>job</code> çš„ä¾è³´é—œä¿‚ã€‚ä½¿ç”¨ <code>runs-on</code> ä¾†æŒ‡å®šåŸ·è¡Œçš„å¯¦ä¾‹
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">my_first_job</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">My first job</span>
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-20.04</span>
  <span style="color:#f92672">my_second_job</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">My second job</span>
    <span style="color:#f92672">needs</span>: <span style="color:#ae81ff">my_first_job</span>
</code></pre></td></tr></table>
</div>
</div><pre><code> &gt; ä¸Šé¢ä¾‹å­æœ‰å…©å€‹ `job`ï¼Œ`job_id` åˆ†åˆ¥ç‚º `my_first_job` å’Œ `my_second_job`ï¼Œ`my_second_job` ä¾è³´æ–¼ `my_first_job`ï¼Œ`my_second_job` éœ€è¦ç­‰å¾… `my_second_job` å®Œæˆæ‰èƒ½åŸ·è¡Œã€‚
</code></pre></li>
<li><strong>step</strong>
æ¯å€‹ <code>job</code> ä¸‹æœ‰å¤šå€‹ <code>step</code>ï¼Œæ¯å€‹ <code>step</code> ä¸»è¦æœ‰ä¸‰å€‹éƒ¨åˆ† ï¼Œ
<ul>
<li><code>jobs.&lt;job_id&gt;.steps.name</code>:  <code>step</code> åç¨±</li>
<li><code>jobs.&lt;job_id&gt;.steps.run</code>: <code>step</code>åŸ·è¡Œçš„æŒ‡ä»¤æˆ–æ˜¯ action</li>
<li><code>jobs.&lt;job_id&gt;.steps.env</code>: <code>step</code> åŸ·è¡Œæ™‚çš„ç’°å¢ƒè®Šæ•¸</li>
</ul>
</li>
</ul>
<p>ç¶œåˆä»¥ä¸Šçš„åŸºæœ¬çµæ§‹ï¼Œä¸€å€‹åŸºæœ¬çš„ workflow YAML çµæ§‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Greet Everyone</span>
<span style="color:#f92672">on</span>: <span style="color:#ae81ff">push</span>
<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">my-job</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">My Job</span>
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
    <span style="color:#f92672">steps</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Print a greeting</span>
      <span style="color:#f92672">env</span>:
        <span style="color:#f92672">MY_VAR</span>: <span style="color:#ae81ff">Hi there! My name is</span>
        <span style="color:#f92672">FIRST_NAME</span>: <span style="color:#ae81ff">Mona</span>
        <span style="color:#f92672">MIDDLE_NAME</span>: <span style="color:#ae81ff">The</span>
        <span style="color:#f92672">LAST_NAME</span>: <span style="color:#ae81ff">Octocat</span>
      <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">        </span>        <span style="color:#ae81ff">echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3-å»ºç«‹-workflow">3. å»ºç«‹ Workflow</h2>
<p>åœ¨ GitHub Actions çš„ Workflow çš„è¨­è¨ˆä¸Šï¼Œæˆ‘æœƒè¶¨å‘æŠŠæŒçºŒæ•´åˆï¼ˆCIï¼‰åŠæŒçºŒéƒ¨ç½²ï¼ˆCDï¼‰åˆ†ç‚ºå…©å€‹ç¨ç«‹çš„ Workflow YAML  æª”ï¼Œåœ¨æ¯æ¬¡æ•´åˆæ˜¯éƒ½èƒ½å…ˆç¶“éæ¸¬è©¦ç¨‹åºï¼Œåœ¨ç¨‹å¼ç¢¼è¼ƒç‚ºç©©å®šçš„æ™‚å€™å†éƒ¨ç½²è‡³æŒ‡å®šçš„ä¼ºæœå™¨ã€‚</p>
<h3 id="31-æŒçºŒæ•´åˆci-continuous-integration">3.1 æŒçºŒæ•´åˆï¼ˆCI: Continuous Integrationï¼‰</h3>
<p>è»Ÿé«”é–‹ç™¼çš„éç¨‹ä¸­ï¼Œæ¸¬è©¦æ˜¯ç›¸ç•¶é‡è¦çš„ä¸€ç’°ã€‚ä»¥ç›®å‰è»Ÿé«”é–‹ç™¼é€æ¼¸æé«˜çš„è¤‡é›œåº¦ï¼Œå·²ç¶“ä¸å®¹æ˜“ä½¿ç”¨å‚³çµ±é•·æ™‚é–“çš„æ¸¬è©¦æ–¹å¼ï¼Œéœ€è¦æ›´å³æ™‚çš„æ¸¬è©¦ã€‚åŠ ä¸Šè»Ÿé«”é–‹ç™¼å¤§éƒ½ä»¥åœ˜éšŠå”åŒåˆä½œé€²è¡Œï¼Œåœ¨å½¼æ­¤ç¨‹å¼ç¢¼æ•´åˆå‰éœ€è¦å…ˆç¶“éæŒçºŒçš„æ¸¬è©¦ã€‚</p>
<p>åœ¨ <code>.github/workflows</code> è³‡æ–™å¤¾ä¸­å»ºç«‹ <code>laravel-ci.yml</code> å…§å®¹å¦‚å¾Œã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Laravel 6 Continuous Integration </span>
<span style="color:#f92672">on</span>:
  <span style="color:#f92672">push</span>:
    <span style="color:#f92672">branches</span>:
      - <span style="color:#ae81ff">master</span>
<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">laravel-tests</span>:
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-20.04</span>
    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup PHP version</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">shivammathur/setup-php@v2</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">php-version</span>: <span style="color:#e6db74">&#34;7.4&#34;</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Copy ENV Laravel Configuration for CI</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          </span>          <span style="color:#ae81ff">php -r &#34;file_exists(&#39;.env&#39;) || copy(&#39;.env.ci&#39;, &#39;.env&#39;);&#34;</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install Dependencies (PHP vendors)</span>
        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">composer install -q --no-ansi --no-interaction --no-scripts --no-suggest --no-progress --prefer-dist</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate key</span>
        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">php artisan key:generate</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Directory Permissions</span>
        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">chmod -R 777 storage bootstrap/cache</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Create DB and schemas</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          mkdir -p database
</span><span style="color:#e6db74">          touch database/database.sqlite
</span><span style="color:#e6db74">          php artisan migrate</span>          
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Run PHPCS Coding Standards</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          </span>          <span style="color:#ae81ff">vendor/bin/phpcs --colors</span>
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Execute tests (Unit and Feature tests) via PHPUnit</span>
        <span style="color:#f92672">env</span>:
          <span style="color:#f92672">DB_CONNECTION</span>: <span style="color:#ae81ff">sqlite</span>
          <span style="color:#f92672">DB_DATABASE</span>: <span style="color:#ae81ff">database/database.sqlite</span>
        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">vendor/bin/phpunit --testdox</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="32-æŒçºŒéƒ¨ç½²cd-continuous-deployment">3.2 æŒçºŒéƒ¨ç½²ï¼ˆCD: Continuous Deploymentï¼‰</h3>
<p>åœ¨å‰æ®µçš„èªªæ˜ä¸­æœ‰æåˆ°åœ¨ç¨‹å¼ç¢¼ç©©å®šä¹‹å¾Œå†éƒ¨ç½²ï¼Œã€Œç©©å®šã€é€™è£¡æˆ‘çš„å®šç¾©æœƒæ˜¯åœ¨ PR ç¢ºèª merge å®Œæˆé—œé–‰æ™‚é€²è¡Œã€‚ä¸»è¦æ˜¯é€é SSH çš„æ–¹å¼ï¼Œé€£çµè‡³æŒ‡å®šä¼ºæœå™¨åŸ·è¡Œéƒ¨ç½²çš„è…³æœ¬ (shell script)ã€‚</p>
<h4 id="321-æº–å‚™å·¥ä½œ">3.2.1 æº–å‚™å·¥ä½œï¼š</h4>
<ol>
<li>
<p>è¨­å®šéƒ¨ç½²å¸³è™Ÿ
ç”±æ–¼æ˜¯ä½¿ç”¨ SSH  æ–¹å¼è®“ GitHub Action å¯ä»¥è¨ªå•æˆ‘å€‘çš„ä¼ºæœå™¨éƒ¨ç½²ï¼Œåœ¨ç›®æ¨™ä¼ºæœå™¨ä¸Šé–‹å•Ÿä¸€å€‹éƒ¨ç½²å°ˆç”¨çš„å¸³è™Ÿï¼Œé™åˆ¶å¸³è™Ÿçš„æ¬Šé™ä¸è¦å¤ªå¤§æé«˜å®‰å…¨æ€§ã€‚</p>
</li>
<li>
<p>å»ºç«‹ä¼ºæœå™¨ç™»å…¥æ†‘è­‰
åœ¨ç›®æ¨™ä¼ºæœå™¨ä¸Šç”¢ç”Ÿä½¿ç”¨ <code>ssh-keygen</code> æŒ‡ä»¤ç”¢ç”Ÿå…¬ç§é‘°ï¼Œå°‡å…¬é‘°åŠ å…¥ <code>authorized_keys</code>ï¼Œç§é‘°åŠ å…¥ GitHub çš„åŠ å¯†è®Šæ•¸ä¸­ï¼Œåšç‚ºé€£ç·šç™»å…¥ä½¿ç”¨çš„æ†‘è­‰ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd ~/.ssh/
$ ssh-keygen -f cicd-github
$ cat ~/.ssh/cicd-github.pub &gt;&gt; ~/.ssh/authorized_keys
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä¿®æ”¹ sudoer æ¬Šé™
å› ç‚ºæˆ‘ä½¿ç”¨ <code>nginx</code> ä½œç‚º Web Serverï¼Œ<code>nginx</code> æœ¬èº«ç„¡æ³•è™•ç† PHP ç¨‹å¼ï¼Œéœ€è¦é€é PHP-FPM (FastCGI Process Manager) ä¾†è§£è­¯è™•ç† ï¼Œéƒ¨ç½²çš„æœ€å¾Œæœƒéœ€è¦é‡æ–° Reload PHP-FPM Serviceï¼Œ<code>systemctl reload</code> ç‚º root æ‰èƒ½åŸ·è¡Œçš„æ¬Šé™ï¼Œä¿®æ”¹ <code>sudoer</code> è®“ <code>cicd-github</code> å¯ä»¥åŸ·è¡Œ PHP-FPM Service Reloadã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo visudo
cicd-github  ALL<span style="color:#f92672">=</span>NOPASSWD: /bin/systemctl reload php7.4-fpm.service
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ–¼ GitHub Actions åŸ·è¡Œæ™‚ç„¡æ³•æ–¼ sudo éç¨‹ä¸­è¼¸å…¥å¯†ç¢¼ï¼Œåœ¨é€™è£¡è¨­å®šç‚º <code>NOPASSWD</code>ï¼ŒåŒæ™‚ä¹Ÿé™åˆ¶å¸³è™Ÿåªèƒ½åŸ·è¡Œ reload é€™å€‹æŒ‡ä»¤</p>
</blockquote>
</li>
<li>
<p>GitHub è¨­å®šåŠ å¯†è®Šæ•¸
GitHub Actions åŸ·è¡Œçš„éç¨‹ä¸­ï¼Œä¸æœƒä¸­æ–·åŸ·è¡Œç­‰å¾…è¼¸å…¥ï¼Œå› æ­¤è¨­å®šåŠ å¯†è®Šæ•¸ (Secrets) è®“ Actions åŸ·è¡ŒæœŸé–“å¸¶å…¥éœ€è¦çš„è®Šæ•¸å…§å®¹ã€‚
åŠ å…¥åŠ å¯†è®Šæ•¸çš„æ–¹æ³•ï¼šGitHub Repo &ndash;&gt; Settings &ndash;&gt; Secrets &ndash;&gt; New repository secret
ä¸»è¦éœ€è¦çš„åƒæ•¸æœ‰ <code>SSH_HOST</code>ã€<code>SSH_USERNAME</code>ã€<code>SSH_PRIVATE_KEY</code></p>
<ul>
<li>SSH_HOSTï¼šä¼ºæœå™¨ä½å€</li>
<li>SSH_USERNAMEï¼šç™»å…¥ä¼ºæœå™¨çš„å¸³è™Ÿåç¨±</li>
<li>SSH_PRIVATE_KEYï¼šç™»å…¥çš„ç§é‘°ï¼Œç”±ä¼ºæœå™¨ <code>cat ~/.ssh/cicd-github</code> å–å¾—å‰é¢ç¬¬2æ­¥é©Ÿçš„ç§é‘°å…§å®¹</li>
</ul>
<blockquote>
<p>è‹¥ SSH ä½¿ç”¨çš„ä¸æ˜¯é è¨­çš„ Portï¼Œå¯ä»¥å¢åŠ  <code>SSH_PORT</code> è®Šæ•¸å­˜å…¥ Port è™Ÿç¢¼</p>
</blockquote>
</li>
<li>
<p>æ–°å¢ Personal access token
åœ¨éƒ¨ç½²è…³æœ¬ä¸­ä¸»è¦ä½¿ç”¨ Git çš„æ–¹å¼ï¼Œä¾†æ‹‰å–ç¨‹å¼ç¢¼è‡³ä¼ºæœå™¨ä¸Šï¼Œå°æ–¼ç§äººå„²å­˜åº« (private repositories) åŸ·è¡ŒæœŸé–“å°‡è¦æ±‚å¿…é ˆè¼¸å…¥ GitHub å¸³è™Ÿå¯†ç¢¼ï¼Œå°‡æœƒé€ æˆåŸ·è¡Œä¸­æ–·ã€‚æˆ‘å€‘å¯ä»¥é€éå»ºç«‹  GitHub <strong>Personal access tokens</strong>ï¼Œè®“ Token ä»£è¡¨ GitHub Account å¯ä»¥å­˜å– GitHub APIï¼ŒåŒæ™‚ä¹Ÿå¯ä»¥å¢åŠ å®‰å…¨æ€§ï¼Œç•¶æ‡·ç–‘ Token å¤–æ´©æ™‚ï¼Œå¯ä»¥é‡æ–°ç”¢ç”Ÿæ–°çš„ Token æ£„ç”¨èˆŠçš„ã€‚
å»ºç«‹ Personal access tokenæ–¹æ³•ï¼š<a href="https://github.com/settings/tokens">GitHub Personal access token</a> &ndash;&gt; Generate new token</p>
</li>
<li>
<p>Git Clone Repository
åœ¨ç›®æ¨™ä¼ºæœå™¨ä¸Šï¼Œä»¥éƒ¨ç½²ç”¨å¸³è™Ÿ (cicd-github) ä½¿ç”¨ https æ–¹å¼ Clone Repository è‡³æœ¬åœ°ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone https://&lt;Github Account&gt;:&lt;Personal access token&gt;@github.com/&lt;Repository&gt;.git
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h4 id="322-ä¼ºæœå™¨éƒ¨ç½²è…³æœ¬">3.2.2 ä¼ºæœå™¨éƒ¨ç½²è…³æœ¬</h4>
<p>å»ºç«‹ä¸€å€‹ Shell Script ï¼Œä¸¦å°‡æª”æ¡ˆåç¨±è¨­å®šç‚º <code>server_deploy.sh</code>ï¼Œè…³æœ¬å…§å®¹å¦‚å¾Œã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>set -e

echo <span style="color:#e6db74">&#34;Deploying application ...&#34;</span>

<span style="color:#75715e"># Enter maintenance mode</span>
<span style="color:#f92672">(</span>php artisan down --message <span style="color:#e6db74">&#39;The app is being (quickly!) updated. Please try again in a minute.&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> true
    <span style="color:#75715e"># Update codebase</span>
    git checkout deploy
    git fetch origin deploy
    git reset --hard origin/deploy

    <span style="color:#75715e"># Install dependencies based on lock file</span>
    composer install --no-interaction --prefer-dist --optimize-autoloader

    <span style="color:#75715e"># Migrate database</span>
    php artisan migrate --force

    <span style="color:#75715e"># Clear cache</span>
    php artisan cache:clear
    php artisan route:clear
    php artisan config:clear
    php artisan view:clear

    <span style="color:#75715e"># Update database classmap</span>
    composer dump-autoload

    <span style="color:#75715e"># Optimizing Configuration Loading</span>
    php artisan config:cache

    <span style="color:#75715e"># Reload PHP to update opcache</span>
    sudo systemctl reload php7.4-fpm.service
<span style="color:#75715e"># Exit maintenance mode</span>
php artisan up

echo <span style="color:#e6db74">&#34;Application deployed!&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>è¨˜å¾—è®“ <code>server_deploy.sh</code> æª”æ¡ˆæœ‰åŸ·è¡Œæ¬Šé™æ‰èƒ½éƒ¨ç½²ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ chmod u+x server_deploy.sh
</code></pre></td></tr></table>
</div>
</div><h4 id="323-å»ºç«‹éƒ¨ç½²-github-action">3.2.3 å»ºç«‹éƒ¨ç½² GitHub Action</h4>
<p>åœ¨ <code>.github/workflows</code> è³‡æ–™å¤¾ä¸­å»ºç«‹ <code>laravel-cd.yml</code> æª”æ¡ˆã€‚Deployment Action åœ¨ GitHub deploy åˆ†æ”¯ PR (pull request) é—œé–‰æ™‚è§¸ç™¼ï¼Œä¸¦åœ¨ç¢ºèª <code>merge</code> å¾Œæ‰åŸ·è¡Œéƒ¨ç½²ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Continuous Deployment Laravel 6</span>
<span style="color:#f92672">on</span>:
  <span style="color:#f92672">pull_request</span>:
    <span style="color:#f92672">branches</span>:
      - <span style="color:#ae81ff">deploy</span>
    <span style="color:#f92672">types</span>: [<span style="color:#ae81ff">closed]</span>

<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">laravel-deploy</span>:
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-20.04</span>
    <span style="color:#f92672">if</span>: <span style="color:#ae81ff">github.event.pull_request.merged == true</span>
    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deployment</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">appleboy/ssh-action@master</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">host</span>: <span style="color:#ae81ff">${{ secrets.SSH_HOST }}</span>
          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{ secrets.SSH_PRIVATE_KEY }}</span>
          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">${{ secrets.SSH_USERNAME }}</span>
          <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">            cd /var/www//html/repository-path
</span><span style="color:#e6db74">            ./server_deploy.sh</span>            
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Note:
è‹¥éœ€è¦ SSH Action å…¶ä»–è¼¸å…¥åƒæ•¸å¯ä»¥åƒè€ƒ <a href="https://github.com/appleboy/ssh-action">SSH for GitHub Actions</a></p>
</blockquote>
<hr>
<p>åƒè€ƒè³‡æ–™ï¼š</p>
<ol>
<li><a href="https://ibe.tw/getting-started-with-github-actions/">GitHub Actions åŸºç¤ä»‹ç´¹</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">GitHub Actions å…¥é—¨æ•™ç¨‹</a></li>
<li><a href="https://www.twilio.com/blog/build-test-deploy-laravel-application-github-actions">Build, Test, and Deploy Your Laravel Application With GitHub Actions</a></li>
<li><a href="https://blog.logrocket.com/how-to-create-a-ci-cd-for-a-laravel-application-using-github-actions/">How to create a CI/CD for a Laravel application using GitHub Actions</a></li>
<li><a href="https://laravel-news.com/push-deploy-with-github-actions">Push deploy a Laravel app for free with GitHub Actions</a></li>
</ol>
</article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="https://ninthday.github.io/tags/laravel"><span class="tag">Laravel</span></a></li>
        
          <li><a href="https://ninthday.github.io/tags/github"><span class="tag">Github</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        Â© This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International Licenseï¼Œplease give source if you wish to quote or reproduce.
      </p>
    </footer>
    
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ninthday" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    
  </section>
  
<footer class="site-footer">
  <p>Â© 2017-2021 have a NINTHDAY</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank" rel="noopener">Nuo</a>.</p>
  
</footer>


<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@15.0.0/dist/smooth-scroll.min.js"></script>



<script async src="https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video.min.js"></script>




<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    },
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>



<script src="https://ninthday.github.io/scripts/index.min.js"></script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('\/service-worker.js').then(function() {
      console.log('[ServiceWorker] Registered');
    });
  }
</script>








  </body>
</html>
